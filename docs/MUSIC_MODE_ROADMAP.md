# FreeTube Music Mode 開發路線圖

## 狀態說明
- ✅ 已完成
- 🚧 開發中
- 📋 待開發
- ⏸️ 暫緩

---

## Phase 1: Core MVP ✅
- ✅ Music Player 基本 UI
- ✅ 播放/暫停/上一首/下一首
- ✅ 進度條拖曳
- ✅ 音量控制
- ✅ 循環模式 (單曲/全部/關閉)
- ✅ 隨機播放
- ✅ Queue 佇列管理
- ✅ Queue 拖曳排序
- ✅ 相關影片推薦
- ✅ 自動播放下一首
- ✅ 歌詞顯示 (LRCLIB)
- ✅ 歌詞同步捲動
- ✅ Watch 頁面音樂模式按鈕
- ✅ 手機版 RWD 適配
- ✅ Race condition 修復

---

## Phase 2: 播放體驗優化 ✅

### 2.1 預載下一首 ✅
- [x] 當前歌曲播放到 80% 時，預先獲取下一首的 audioUrl
- [x] 快取 audioUrl (LRU cache, max 10 entries)
- [x] 預載完成後 console log

### 2.2 記住播放設定 ✅
- [x] localStorage 儲存音量
- [x] localStorage 儲存循環模式
- [x] localStorage 儲存隨機模式
- [x] 下次開啟自動套用

### 2.3 歌詞快取 ✅
- [x] 本地服務器端歌詞快取 (檔案系統持久化)
- [x] 多裝置共享快取 (Device A 抓過，Device B 不用再打 API)
- [x] 快取位置: ~/.freetube-cache/lyrics/
- [x] 自動 fallback 到直接 LRCLIB

### 2.4 播放速度控制 📋
- [ ] 0.5x, 0.75x, 1x, 1.25x, 1.5x, 2x
- [ ] UI 按鈕切換
- [ ] 記住上次設定

### 2.5 Crossfade 淡入淡出 📋
- [ ] 設定頁面開關 (預設關閉)
- [ ] 可調整淡入淡出時長 (1-5秒)
- [ ] 雙 audio element 實現

---

## Phase 3: 鍵盤快捷鍵 📋

### 3.1 基本快捷鍵 📋
- [ ] Space: 播放/暫停
- [ ] ←/→: 快轉/倒轉 5 秒
- [ ] ↑/↓: 音量 +/- 10%
- [ ] N: 下一首
- [ ] P: 上一首
- [ ] M: 靜音切換
- [ ] L: 切換歌詞顯示
- [ ] R: 切換循環模式
- [ ] S: 切換隨機模式

### 3.2 快捷鍵提示 📋
- [ ] 按 ? 顯示快捷鍵列表
- [ ] Toast 提示目前操作

---

## Phase 4: 手機優化 📋

### 4.1 滑動手勢 📋
- [ ] 左右滑動切歌
- [ ] 專輯封面區域上下滑調音量
- [ ] 長按快轉

### 4.2 迷你播放器 📋
- [ ] 離開 /music 路由時顯示
- [ ] 固定在底部
- [ ] 顯示: 封面、標題、播放/暫停
- [ ] 點擊展開完整播放器
- [ ] 可以關閉

### 4.3 通知欄控制 (Electron) 📋
- [ ] 顯示當前播放歌曲
- [ ] 播放/暫停/上下首控制
- [ ] 專輯封面顯示

---

## Phase 5: 視覺效果 📋

### 5.1 背景模糊 📋
- [ ] 提取專輯封面主色調
- [ ] 動態漸層背景
- [ ] 模糊效果

### 5.2 音樂視覺化 📋
- [ ] Web Audio API 分析音頻
- [ ] 波形顯示
- [ ] 頻譜動畫
- [ ] 可開關

---

## Phase 6: 進階功能 📋

### 6.1 睡眠定時器 📋
- [ ] 15/30/45/60 分鐘選項
- [ ] 自訂時間
- [ ] 倒數顯示
- [ ] 時間到淡出停止

### 6.2 歌詞手動搜尋 📋
- [ ] 找不到歌詞時顯示搜尋框
- [ ] 可輸入歌名/歌手搜尋
- [ ] 顯示多個結果供選擇
- [ ] 手動選擇後記住

### 6.3 播放歷史 📋
- [ ] 記錄最近播放
- [ ] 最多 100 首
- [ ] 可清除歷史
- [ ] 從歷史播放

---

## Phase 7: 程式碼品質 📋

### 7.1 清理 📋
- [ ] 移除 console.log (生產環境)
- [ ] 統一錯誤處理
- [ ] 加入 TypeScript 型別

### 7.2 測試 📋
- [ ] 單元測試 (musicMode store)
- [ ] 元件測試 (MusicPlayer)
- [ ] E2E 測試 (播放流程)

---

## 優先順序建議

### 高優先 (影響體驗)
1. 預載下一首
2. 記住播放設定
3. 鍵盤快捷鍵
4. 迷你播放器

### 中優先 (錦上添花)
5. 背景模糊
6. 睡眠定時器
7. 播放速度

### 低優先 (進階功能)
8. Crossfade
9. 音樂視覺化
10. 歌詞手動搜尋

---

*最後更新: 2025-12-31*
